<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的文件库</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#8B5CF6',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-custom {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .hover-scale {
                @apply hover:scale-105 transition-all duration-300;
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
        }
    </style>
</head>
<body class="font-inter bg-gray-50 text-gray-800 min-h-screen flex flex-col">
    <!-- 导航栏 -->
    <header class="bg-primary text-white shadow-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-cloud text-2xl"></i>
                <h1 class="text-xl md:text-2xl font-bold text-shadow">我的文件库</h1>
            </div>
            <div id="auth-buttons" class="flex items-center space-x-4">
                <button id="login-btn" class="px-4 py-2 rounded-md bg-white text-primary font-medium hover:bg-gray-100 transition-custom">
                    <i class="fa fa-sign-in mr-1"></i> 登录
                </button>
                <button id="logout-btn" class="px-4 py-2 rounded-md bg-red-600 text-white font-medium hover:bg-red-700 transition-custom hidden">
                    <i class="fa fa-sign-out mr-1"></i> 退出
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="flex-grow container mx-auto px-4 py-8">
        <!-- 欢迎信息 -->
        <section class="mb-8 text-center">
            <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-gray-800 mb-2">欢迎访问我的文件库</h2>
            <p class="text-gray-600 max-w-2xl mx-auto">这里可以下载我分享的文件。登录后可以上传新文件。</p>
        </section>

        <!-- 上传区域 (默认隐藏，登录后显示) -->
        <section id="upload-section" class="mb-10 bg-white rounded-xl p-6 shadow-lg hidden">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold text-gray-800">上传新文件</h3>
                <span id="upload-status" class="text-sm text-gray-500"></span>
            </div>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-primary transition-custom">
                <input type="file" id="file-input" class="hidden" multiple>
                <label for="file-input" class="cursor-pointer">
                    <i class="fa fa-cloud-upload text-4xl text-primary mb-3"></i>
                    <p class="text-gray-600 mb-1">点击或拖拽文件到这里上传</p>
                    <p class="text-xs text-gray-500">支持多种文件格式</p>
                </label>
            </div>
            <div id="upload-progress-container" class="mt-4 hidden">
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="upload-progress-bar" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                </div>
                <p id="upload-progress-text" class="text-sm text-gray-600 mt-1">准备上传...</p>
            </div>
        </section>

        <!-- 文件列表 -->
        <section class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">文件列表</h3>
                <div class="relative">
                    <input type="text" id="search-input" placeholder="搜索文件..." 
                           class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                    <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
            
            <div id="file-list" class="space-y-4">
                <!-- 文件项将通过JavaScript动态添加 -->
                <div class="text-center py-12 text-gray-500">
                    <i class="fa fa-folder-open-o text-5xl mb-3"></i>
                    <p>暂无文件</p>
                </div>
            </div>
        </section>
    </main>

    <!-- 登录模态框 -->
    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl transform transition-all">
            <div class="text-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">登录</h3>
                <p class="text-gray-500">输入密码访问上传功能</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                    <div class="relative">
                        <input type="password" id="password" placeholder="请输入密码" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                        <button type="button" id="toggle-password" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                            <i class="fa fa-eye-slash"></i>
                        </button>
                    </div>
                </div>
                <div class="pt-2">
                    <button id="submit-login" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-2.5 px-4 rounded-lg transition-custom">
                        登录
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center space-x-2">
                        <i class="fa fa-cloud text-xl"></i>
                        <span class="font-bold text-lg">我的文件库</span>
                    </div>
                    <p class="text-gray-400 text-sm mt-1">安全、便捷的文件分享平台</p>
                </div>
                <div class="text-gray-400 text-sm">
                    &copy; 2025 我的文件库. 保留所有权利.
                </div>
            </div>
        </div>
    </footer>

    <script>
        // 配置信息（实际使用时应从安全的后端获取）
        const config = {
            password: "150123llD", // 替换为你的密码
            storageKey: "my_file_library",
            apiUrl: "https://github.com/km1753/zmgame.git" // 替换为你的API地址
        };

        // DOM元素
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const loginModal = document.getElementById('login-modal');
        const passwordInput = document.getElementById('password');
        const togglePassword = document.getElementById('toggle-password');
        const submitLogin = document.getElementById('submit-login');
        const uploadSection = document.getElementById('upload-section');
        const fileInput = document.getElementById('file-input');
        const fileList = document.getElementById('file-list');
        const searchInput = document.getElementById('search-input');
        const uploadProgressContainer = document.getElementById('upload-progress-container');
        const uploadProgressBar = document.getElementById('upload-progress-bar');
        const uploadProgressText = document.getElementById('upload-progress-text');
        const uploadStatus = document.getElementById('upload-status');

        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            // 检查是否已登录
            if (localStorage.getItem('isLoggedIn') === 'true') {
                loginSuccess();
            }

            // 加载文件列表
            loadFiles();

            // 事件监听器
            loginBtn.addEventListener('click', () => {
                loginModal.classList.remove('hidden');
                passwordInput.focus();
            });

            logoutBtn.addEventListener('click', () => {
                localStorage.removeItem('isLoggedIn');
                logoutBtn.classList.add('hidden');
                loginBtn.classList.remove('hidden');
                uploadSection.classList.add('hidden');
                showToast('已退出登录');
            });

            togglePassword.addEventListener('click', () => {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                togglePassword.innerHTML = type === 'password' ? '<i class="fa fa-eye-slash"></i>' : '<i class="fa fa-eye"></i>';
            });

            submitLogin.addEventListener('click', () => {
                const password = passwordInput.value.trim();
                if (password === config.password) {
                    loginSuccess();
                    loginModal.classList.add('hidden');
                    passwordInput.value = '';
                    showToast('登录成功');
                } else {
                    showToast('密码错误', 'error');
                }
            });

            fileInput.addEventListener('change', handleFileUpload);

            searchInput.addEventListener('input', () => {
                const searchTerm = searchInput.value.toLowerCase().trim();
                filterFiles(searchTerm);
            });
        });

        // 登录成功处理
        function loginSuccess() {
            localStorage.setItem('isLoggedIn', 'true');
            logoutBtn.classList.remove('hidden');
            loginBtn.classList.add('hidden');
            uploadSection.classList.remove('hidden');
        }

        // 加载文件列表
        function loadFiles() {
            // 从localStorage获取文件列表（实际使用时应从后端API获取）
            const files = JSON.parse(localStorage.getItem(config.storageKey) || '[]');
            
            if (files.length === 0) {
                fileList.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <i class="fa fa-folder-open-o text-5xl mb-3"></i>
                        <p>暂无文件</p>
                    </div>
                `;
                return;
            }

            fileList.innerHTML = '';
            files.forEach(file => {
                addFileToUI(file);
            });
        }

        // 添加文件到UI
        function addFileToUI(file) {
            const fileSize = formatFileSize(file.size);
            const fileType = getFileType(file.name);
            const fileIcon = getFileIcon(fileType);
            
            const fileItem = document.createElement('div');
            fileItem.className = 'bg-gray-50 rounded-lg p-4 flex items-center justify-between hover-scale card-shadow';
            fileItem.dataset.filename = file.name.toLowerCase();
            fileItem.dataset.type = fileType.toLowerCase();
            
            fileItem.innerHTML = `
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
                        <i class="fa ${fileIcon} text-xl"></i>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-800 truncate max-w-xs md:max-w-md">${file.name}</h4>
                        <p class="text-sm text-gray-500">${fileSize} · ${formatDate(file.date)}</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button class="download-btn px-3 py-1.5 bg-primary text-white rounded-md hover:bg-primary/90 transition-custom flex items-center">
                        <i class="fa fa-download mr-1"></i> 下载
                    </button>
                    ${localStorage.getItem('isLoggedIn') === 'true' ? 
                        `<button class="delete-btn px-3 py-1.5 bg-red-500 text-white rounded-md hover:bg-red-600 transition-custom flex items-center">
                            <i class="fa fa-trash mr-1"></i> 删除
                        </button>` : ''
                    }
                </div>
            `;
            
            fileList.appendChild(fileItem);
            
            // 添加下载事件
            const downloadBtn = fileItem.querySelector('.download-btn');
            downloadBtn.addEventListener('click', () => {
                downloadFile(file);
            });
            
            // 添加删除事件（仅登录用户可见）
            const deleteBtn = fileItem.querySelector('.delete-btn');
            if (deleteBtn) {
                deleteBtn.addEventListener('click', () => {
                    deleteFile(file, fileItem);
                });
            }
        }

        // 处理文件上传
        function handleFileUpload(event) {
            const files = event.target.files;
            if (!files.length) return;
            
            uploadStatus.textContent = `准备上传 ${files.length} 个文件...`;
            uploadProgressContainer.classList.remove('hidden');
            
            // 逐个上传文件
            Array.from(files).forEach((file, index) => {
                uploadFile(file, index, files.length);
            });
            
            // 重置文件输入
            fileInput.value = '';
        }

        // 上传单个文件
        function uploadFile(file, index, total) {
            // 更新上传进度
            updateProgress(index, total, `正在上传: ${file.name}`);
            
            // 模拟上传过程（实际使用时应发送到后端API）
            setTimeout(() => {
                // 创建文件对象
                const fileData = {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    date: new Date().toISOString(),
                    // 实际使用时，这里应该存储从服务器返回的文件URL
                    url: URL.createObjectURL(file)
                };
                
                // 保存到localStorage（实际使用时应发送到后端）
                saveFile(fileData);
                
                // 更新进度
                updateProgress(index + 1, total, `已完成: ${file.name}`);
                
                // 全部完成后刷新列表
                if (index === total - 1) {
                    setTimeout(() => {
                        uploadProgressContainer.classList.add('hidden');
                        uploadStatus.textContent = `已成功上传 ${total} 个文件`;
                        loadFiles();
                        
                        // 5秒后清除状态
                        setTimeout(() => {
                            uploadStatus.textContent = '';
                        }, 5000);
                    }, 500);
                }
            }, 1500 + Math.random() * 1000); // 模拟1.5-2.5秒的上传时间
        }

        // 保存文件到localStorage（实际使用时应替换为后端API调用）
        function saveFile(file) {
            const files = JSON.parse(localStorage.getItem(config.storageKey) || '[]');
            files.push(file);
            localStorage.setItem(config.storageKey, JSON.stringify(files));
        }

        // 下载文件
        function downloadFile(file) {
            // 实际使用时，这里应该从服务器获取文件URL
            // 这里使用localStorage中存储的临时URL（仅用于演示）
            const link = document.createElement('a');
            link.href = file.url;
            link.download = file.name;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast(`开始下载: ${file.name}`);
        }

        // 删除文件
        function deleteFile(file, fileItem) {
            if (!confirm(`确定要删除 "${file.name}" 吗？`)) return;
            
            // 从UI中移除
            fileItem.classList.add('opacity-0');
            fileItem.style.transition = 'opacity 0.3s ease-out';
            
            // 从localStorage中删除（实际使用时应调用后端API）
            let files = JSON.parse(localStorage.getItem(config.storageKey) || '[]');
            files = files.filter(f => f.name !== file.name);
            localStorage.setItem(config.storageKey, JSON.stringify(files));
            
            // 动画结束后刷新列表
            setTimeout(() => {
                loadFiles();
                showToast(`已删除: ${file.name}`);
            }, 300);
        }

        // 过滤文件列表
        function filterFiles(searchTerm) {
            const fileItems = document.querySelectorAll('#file-list > div');
            
            if (!searchTerm) {
                fileItems.forEach(item => {
                    item.classList.remove('hidden');
                });
                return;
            }
            
            let hasResults = false;
            fileItems.forEach(item => {
                const filename = item.dataset.filename;
                const filetype = item.dataset.type;
                
                if (filename.includes(searchTerm) || filetype.includes(searchTerm)) {
                    item.classList.remove('hidden');
                    hasResults = true;
                } else {
                    item.classList.add('hidden');
                }
            });
            
            // 如果没有结果，显示空状态
            if (!hasResults) {
                fileList.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <i class="fa fa-search text-5xl mb-3"></i>
                        <p>未找到匹配的文件</p>
                    </div>
                `;
            }
        }

        // 更新上传进度
        function updateProgress(current, total, message) {
            const percentage = Math.round((current / total) * 100);
            uploadProgressBar.style.width = `${percentage}%`;
            uploadProgressText.textContent = `${message} (${current}/${total})`;
        }

        // 显示通知提示
        function showToast(message, type = 'success') {
            // 创建toast元素
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-y-10 opacity-0 ${
                type === 'error' ? 'bg-red-500 text-white' : 'bg-green-500 text-white'
            }`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fa ${type === 'error' ? 'fa-exclamation-circle' : 'fa-check-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            // 添加到页面
            document.body.appendChild(toast);
            
            // 显示动画
            setTimeout(() => {
                toast.classList.remove('translate-y-10', 'opacity-0');
            }, 10);
            
            // 3秒后隐藏
            setTimeout(() => {
                toast.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // 格式化日期
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // 获取文件类型
        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            
            const imageExts = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg'];
            const videoExts = ['mp4', 'mov', 'avi', 'mkv', 'wmv', 'webm'];
            const audioExts = ['mp3', 'wav', 'ogg', 'flac', 'aac'];
            const docExts = ['pdf', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx', 'txt'];
            const archiveExts = ['zip', 'rar', '7z', 'tar', 'gz'];
            
            if (imageExts.includes(ext)) return 'image';
            if (videoExts.includes(ext)) return 'video';
            if (audioExts.includes(ext)) return 'audio';
            if (docExts.includes(ext)) return 'document';
            if (archiveExts.includes(ext)) return 'archive';
            
            return 'file';
        }

        // 获取文件图标
        function getFileIcon(fileType) {
            const icons = {
                image: 'fa-file-image-o',
                video: 'fa-file-video-o',
                audio: 'fa-file-audio-o',
                document: 'fa-file-text-o',
                archive: 'fa-file-archive-o',
                file: 'fa-file-o'
            };
            
            return icons[fileType] || icons.file;
        }
    </script>
</body>
</html>
    